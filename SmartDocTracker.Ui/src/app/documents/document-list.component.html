<div class="document-list-container">
  <!-- Header -->
  <div class="document-list-header">
    <h2>Document Management</h2>
    <button 
      *ngIf="canUpload" 
      class="btn btn-primary upload-btn" 
      (click)="openUploadModal()"
    >
      <span class="material-icons-outlined">upload</span>
      Upload Document
    </button>
  </div>
  
  <!-- Filter Controls -->
  <div class="filters">
    <form [formGroup]="filterForm">
      <div class="filter-row">
        <div class="filter-group">
          <label for="status">Status</label>
          <select id="status" formControlName="status">
            <option value="">All Statuses</option>
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="uploadedById">Uploaded By ID</label>
          <input 
            type="text" 
            id="uploadedById" 
            formControlName="uploadedById" 
            placeholder="Enter uploader ID"
          >
        </div>

        <div class="filter-group">
          <label for="search">Search</label>
          <input 
            type="text" 
            id="search" 
            formControlName="search" 
            placeholder="Search documents..."
          >
        </div>

        <button type="button" class="reset-btn" (click)="resetFilters()">
          Reset Filters
        </button>
      </div>
    </form>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading">
    Loading documents...
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && documents.length === 0" class="empty-state">
    <div class="empty-state-icon">üìÑ</div>
    <h3>No Documents Found</h3>
    <p>Try adjusting your filters or upload some documents to get started.</p>
  </div>

  <!-- Documents Grid -->
  <div *ngIf="!isLoading && documents.length > 0" class="document-grid">
    <table class="document-table">
      <thead>
        <tr>
          <th>File Name</th>
          <th>Upload Date</th>
          <th>Status</th>
          <th>Uploaded By</th>
          <th>Document Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let doc of documents; trackBy: trackByDocId">
          <td>
            <strong>{{ doc.title }}</strong>
          </td>
          <td>{{ doc.uploadDate | date:'MMM dd, yyyy - HH:mm' }}</td>
          <td>
            <span class="status-badge" [ngClass]="'status-' + doc.status.toLowerCase()">
              {{ doc.status }}
            </span>
          </td>
          <td>{{ doc.uploadedById || 'Unknown' }}</td>
          <td>
            <div class="document-status-actions">
              <button 
                class="status-btn approve-btn" 
                (click)="confirmApprove(doc)"
                [disabled]="doc.status === 'Approved'"
                title="Approve Document"
              >
                <span class="material-icons-outlined">check_circle</span>
              </button>
              <button 
                class="status-btn reject-btn" 
                (click)="confirmReject(doc)"
                [disabled]="doc.status === 'Rejected'"
                title="Reject Document"
              >
                <span class="material-icons-outlined">cancel</span>
              </button>
            </div>
          </td>
          <td>
            <div class="action-buttons">
              <button class="action-btn view-btn" (click)="viewDocument(doc.id)">
                <span class="material-icons-outlined">visibility</span>
                View
              </button>
              <!-- <button class="action-btn download-btn" (click)="uploadDocument(doc.id)">
                <span class="material-icons-outlined">download</span>
                Download
              </button> -->
              <button 
                *ngIf="canDelete" 
                class="action-btn delete-btn" 
                (click)="confirmDelete(doc)"
              >
                <span class="material-icons-outlined">delete</span>
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && documents.length > 0" class="pagination">
    <button 
      class="pagination-btn" 
      (click)="onPageChange(currentPage - 1)" 
      [disabled]="currentPage === 1"
    >
      ‚Üê Previous
    </button>
    
    <div class="page-info">
      Page {{ currentPage }} of {{ getTotalPages() }} ({{ totalItems }} total)
    </div>
    
    <button 
      class="pagination-btn" 
      (click)="onPageChange(currentPage + 1)" 
      [disabled]="currentPage >= getTotalPages()"
    >
      Next ‚Üí
    </button>
  </div>
</div>

<!-- PDF Viewer Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ currentDocumentTitle }}</h3>
      <button class="close-btn" (click)="closeModal()" aria-label="Close modal">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <div *ngIf="isLoadingPdf" class="loading-pdf">
        <div class="loading-spinner"></div>
        <p>Loading PDF...</p>
      </div>
      
      <div *ngIf="!isLoadingPdf && pdfBase64" class="pdf-viewer">
        <pdf-viewer
          [src]="pdfBase64"
          [render-text]="true"
          [original-size]="false"
          [zoom]="1.0"
          style="display: block; width: 100%; height: 600px;"
        ></pdf-viewer>
      </div>
      
      <div *ngIf="!isLoadingPdf && !pdfUrl" class="error-message">
        <span class="material-icons-outlined" style="font-size: 3rem; color: #dc3545;">error</span>
        <p>Unable to load PDF. Please try again or contact support.</p>
        <button class="btn btn-secondary" (click)="viewDocument(getCurrentDocumentId())">
          <span class="material-icons-outlined">refresh</span>
          Retry
        </button>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">Close</button>
      <button class="btn btn-primary" (click)="downloadCurrentPdf()">
        Download PDF
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirmation" class="modal-overlay" (click)="cancelDelete()">
  <div class="modal-container delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header delete-header">
      <h3>
        <span class="material-icons-outlined">warning</span>
        Confirm Delete
      </h3>
      <button class="close-btn" (click)="cancelDelete()" aria-label="Close modal">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="delete-warning">
        <div class="warning-icon">
          <span class="material-icons-outlined">delete_forever</span>
        </div>
        <div class="warning-content">
          <h4>Are you sure you want to delete this document?</h4>
          <p><strong>{{ documentToDelete?.title }}</strong></p>
          <p class="warning-text">This action cannot be undone. The document will be permanently removed from the system.</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="cancelDelete()"
        [disabled]="isDeleting"
      >
        Cancel
      </button>
      <button 
        class="btn btn-danger" 
        (click)="deleteDocument()"
        [disabled]="isDeleting"
      >
        <span class="material-icons-outlined">delete</span>
        {{ isDeleting ? 'Deleting...' : 'Delete Document' }}
      </button>
    </div>
  </div>
</div>

<!-- Approve Confirmation Modal -->
<div *ngIf="showApprovalConfirmation" class="modal-overlay" (click)="cancelApproval()">
  <div class="modal-container approve-modal" (click)="$event.stopPropagation()">
    <div class="modal-header approve-header">
      <h3>
        <span class="material-icons-outlined">check_circle</span>
        Confirm Approval
      </h3>
      <button class="close-btn" (click)="cancelApproval()" aria-label="Close modal">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="approval-warning">
        <div class="approval-icon">
          <span class="material-icons-outlined">check_circle_outline</span>
        </div>
        <div class="approval-content">
          <h4>Are you sure you want to approve this document?</h4>
          <p><strong>{{ documentToApprove?.title }}</strong></p>
          <p class="approval-text">This document will be marked as approved and ready for use.</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="cancelApproval()"
        [disabled]="isUpdatingStatus"
      >
        No
      </button>
      <button 
        class="btn btn-success" 
        (click)="approveDocument()"
        [disabled]="isUpdatingStatus"
      >
        <span class="material-icons-outlined">check_circle</span>
        {{ isUpdatingStatus ? 'Approving...' : 'Yes, Approve' }}
      </button>
    </div>
  </div>
</div>

<!-- Reject Confirmation Modal -->
<div *ngIf="showRejectionConfirmation" class="modal-overlay" (click)="cancelRejection()">
  <div class="modal-container reject-modal" (click)="$event.stopPropagation()">
    <div class="modal-header reject-header">
      <h3>
        <span class="material-icons-outlined">cancel</span>
        Reject Document
      </h3>
      <button class="close-btn" (click)="cancelRejection()" aria-label="Close modal">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="rejection-warning">
        <div class="rejection-icon">
          <span class="material-icons-outlined">cancel</span>
        </div>
        <div class="rejection-content">
          <h4>Are you sure you want to reject this document?</h4>
          <p><strong>{{ documentToReject?.title }}</strong></p>
          
          <!-- Comments Field -->
          <div class="comments-section">
            <label for="rejectionComments" class="comments-label">
              <span class="material-icons-outlined">comment</span>
              Comments (Required) *
            </label>
            <textarea
              id="rejectionComments"
              [(ngModel)]="rejectionComments"
              class="comments-textarea"
              placeholder="Please provide a reason for rejection..."
              rows="4"
              maxlength="500"
              required
            ></textarea>
            <div class="character-count">
              {{ rejectionComments.length }}/500 characters
            </div>
          </div>
          
          <p class="rejection-text">This document will be marked as rejected and sent back for review.</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="cancelRejection()"
        [disabled]="isUpdatingStatus"
      >
        Cancel
      </button>
      <button 
        class="btn btn-danger" 
        (click)="rejectDocument()"
        [disabled]="isUpdatingStatus || !rejectionComments.trim()"
      >
        <span class="material-icons-outlined">cancel</span>
        {{ isUpdatingStatus ? 'Rejecting...' : 'Reject Document' }}
      </button>
    </div>
  </div>
</div>

<!-- Upload Modal -->
<div *ngIf="showUploadModal" class="modal-overlay" (click)="closeUploadModal()">
  <div class="modal-container upload-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <span class="material-icons-outlined">upload</span>
        Upload Document
      </h3>
      <button class="close-btn" (click)="closeUploadModal()" aria-label="Close modal">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <!-- User Assignment Section -->
      <div class="user-assignment-section">
        <div class="assignment-group">
          <label for="userSelect">
            <span class="material-icons-outlined">person</span>
            Assign to User *
          </label>
          <div class="select-wrapper">
            <select 
              id="userSelect" 
              [value]="selectedUserId" 
              (change)="onUserSelect($event)"
              [disabled]="isLoadingUsers || isUploading"
              class="user-select"
            >
              <option value="" disabled>
                {{ isLoadingUsers ? 'Loading users...' : 'Select a user' }}
              </option>
              <option *ngFor="let user of users" [value]="user.id">
                {{ user.fullName }}
              </option>
            </select>
            <span class="select-arrow material-icons-outlined">expand_more</span>
          </div>
        </div>
      </div>

      <!-- Upload Area -->
      <div 
        class="upload-area"
        [class.drag-over]="isDragOver"
        [class.has-file]="selectedFile"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <div *ngIf="!selectedFile" class="upload-prompt">
          <div class="upload-icon">
            <span class="material-icons-outlined">cloud_upload</span>
          </div>
          <h4>Drop your PDF file here</h4>
          <p>or <span class="browse-link">browse files</span></p>
          <input 
            type="file" 
            accept=".pdf,application/pdf" 
            (change)="onFileSelect($event)"
            style="display: none;"
            #fileInput
          >
          <button 
            type="button" 
            class="btn btn-outline-primary browse-btn"
            (click)="fileInput.click()"
          >
            <span class="material-icons-outlined">folder_open</span>
            Browse Files
          </button>
          <p class="upload-note">Maximum file size: 10MB</p>
        </div>

        <!-- Selected File Display -->
        <div *ngIf="selectedFile && !isUploading" class="selected-file">
          <div class="file-info">
            <span class="material-icons-outlined file-icon">picture_as_pdf</span>
            <div class="file-details">
              <h5>{{ selectedFile.name }}</h5>
              <p>{{ formatFileSize(selectedFile.size) }}</p>
            </div>
            <button 
              type="button" 
              class="remove-file-btn"
              (click)="removeSelectedFile()"
              aria-label="Remove file"
            >
              <span class="material-icons-outlined">close</span>
            </button>
          </div>
        </div>

        <!-- Upload Progress -->
        <div *ngIf="isUploading" class="upload-progress">
          <div class="upload-spinner">
            <div class="loading-spinner"></div>
          </div>
          <h4>Uploading...</h4>
          <p>Please wait while your document is being uploaded.</p>
        </div>
      </div>

      <!-- Success Message -->
      <div *ngIf="uploadSuccess" class="alert alert-success">
        <span class="material-icons-outlined">check_circle</span>
        {{ uploadSuccess }}
      </div>

      <!-- Error Message -->
      <div *ngIf="uploadError" class="alert alert-danger">
        <span class="material-icons-outlined">error</span>
        {{ uploadError }}
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="closeUploadModal()"
        [disabled]="isUploading"
      >
        Cancel
      </button>
      <button 
        class="btn btn-primary" 
        (click)="uploadFile()"
        [disabled]="!selectedFile || !selectedUserId || isUploading"
      >
        <span class="material-icons-outlined">upload</span>
        {{ isUploading ? 'Uploading...' : 'Upload' }}
      </button>
    </div>
  </div>
</div>